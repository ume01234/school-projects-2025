# タイトル：MIYAKU-MANDALA — p5.js 曼荼羅を Three.js 空間に持ち込み、赤青の流動ブロブで「縁（えん）」を可視化する展示作品の最小実装


## 完成イメージ
完成形は、展示空間の黒暗を想定した大型スクリーン上に表示される「半立体的な曼荼羅空間」です。観客は画面を正面から見ると、曼荼羅が45度に傾いた平面（床・基盤）として存在しており、その表面と空間に多数の「赤／青を基調とした流動的なブロブ（象徴体）」が浮遊・循環しています。

主要な視覚要素は以下の通りです。
- 曼荼羅（床）：
p5.jsで描かれた放射状・同心輪の最小構造（中心光、3〜6層の輪と分割要素）。このキャンバスを Three.js の plane にテクスチャとして貼り、45°の視点から観ることで疑似的な立体感を出す。
- 流動ブロブ（ミャク的象徴体）：
数十〜数百のブロブは常に形を変え、膨張・収縮・融合・分裂を繰り返す。色調は赤と青が主で、グラデーションやパルスで金剛界（青）／胎蔵界（赤）の二元性を示す。表面変形は GLSLノイズ（FBM）や頂点変位で表現する。
- 運動と縁：
各ブロブは曼荼羅の層（輪）に沿って主に循環し、近接や重なりによって「融合」「分裂」「軌道変化」が発生する（これが「縁＝相互作用」を示す）。運動は滑らかで生物的（粘液的）に見える。
- 奥行きと立体感：
カメラを固定で45°に傾け、深度順や透過表現によりブロブの重なりと曼荼羅の層状性が明確にわかる。将来は音響を重ねる想定だが現段階では未実装。

視覚的には「秩序（曼荼羅）」と「流動（ブロブ）」の対比・統合が主題で、観者は静かに世界の摂理（縁起）を見届けるような体験に導かれます。

## プロジェクト概要（目的と範囲）
### 目的：
既存の p5.js 作品（曼荼羅的幾何）である、sketch.jsの内容を活かしつつ、Three.js を用いて “半立体的な曼荼羅空間” を構築し、動的ブロブによって「縁」の概念を視覚化した展示用メディアアートの最小実装を作る。

### 範囲（本フェーズでの実装項目）：
- p5.js で描画される曼荼羅を「最小限構造」に整理する（p5側：既存コードを流用・調整）。
- p5 の canvas を Three.js の CanvasTexture として貼った plane を 45° で配置（疑似3D）。
- Three.js 上で赤青の変形するブロブ（InstancedMesh または shader-based パーティクル）を多数生成する。
- 各ブロブの初期配置・軌道は p5 が出力する「曼荼羅層メタデータ」（各輪の半径・分割数等）を参照して決定する。
- ブロブは曼荼羅の輪に沿って循環し、近接時に「融合・分裂・軌道変化」等の相互作用を行うことで「縁」を表現する。
- 音響はこのフェーズでは実装しない（将来的に追加予定）。

## 実装方針（高レベル指示）：
- p5.js 側：現行の曼荼羅生成コードを「最小限構造」にリファクタリングし、毎フレームまたは必要時に window.mandalaMeta のような形で JSON（layers: [{id, radius, count, color}, ...]）をグローバルに露出する。キャンバス要素は DOM 上で取得可能にする（例：#defaultCanvas0）。
- Three.js 側：p5 の canvas を THREE.CanvasTexture として接続。plane を配置してカメラを 45° に固定。ブロブは GPU シェーダ（頂点変位／FBM）または最小コストの InstancedMesh を用いて高速に描画する。ブロブの運動ルールはシンプルなエージェントモデル（位置・速度・所属輪ID・状態）で実装。
- 連携ルール：p5 が出す layers の radius は canvas ピクセル単位か比率で渡し、Three.js 側で plane ローカル座標に変換して使用する。各層に沿って blob を count 個ずつ初期配置。
- 縁（相互作用）：近接距離判定で「融合（合体）」「分裂（発生）」「回避／追従」などの確率的ルールを適用。重なりや色変化で視覚化する。
- パフォーマンス：InstancedMesh、シェーダベース変形、LOD（個数調整）を用い、60fps を目標に最適化する。

## 機能要件（箇条）：
- p5.js が描く曼荼羅 canvas を Three.js のテクスチャとしてリアルタイムに表示すること。
- p5.js は曼荼羅の層情報（radius、count、color）を JSON 形式で露出すること。
- Three.js で plane（曼荼羅）を 45° 傾けて描画すること（カメラ固定）。
- Three.js で N 個の変形ブロブを生成し、GPU で滑らかに変形させること。
- 各ブロブは p5 の層情報に基づき各輪に沿って循環させること。
- ブロブ間の近接で「融合」「分裂」「軌道変化」等のイベントが発生すること（縁の表現）。
- ブラウザ単体で動作すること（追加のネイティブ依存なし）。
- 音響はこのフェーズでは未実装（フラグのみ設置可）。

## 非機能要件（箇条）
- ブラウザ互換性（最新のChrome/Edgeを想定）
- フレームレートに配慮（60fps目標、最低30fpsで安定）
- GPU負荷が高い場合は Instance 数やシェーダ品質を自動で落とす LOD を用意
- アセット・コードは展示用としてローカルで即実行できること（index.html 単体で起動）
- ミャクミャクの権利侵害を避けるため、象徴体は抽象的表現に留めること（明確なキャラクター模倣を行わない）

## 優先実装ステップ（要約）
- p5.js の曼荼羅を最小構造化・mandalaMeta を出力。
- Three.js に p5 canvas を CanvasTexture として貼付、plane を 45° に配置。
- Three.js 側で Instanced blob を実装し、単純なノイズ変形で滑らかに形を変化させる。
- p5 の mandalaMeta を読み込み、各 ring に沿って blob を初期配置し、循環させる。
- 近接ルール（融合／分裂／軌道変化）を入れて「縁」の表現を実現。
- 見た目調整とパフォーマンス最適化。音響は保留。

## 制約・注意事項（重要）
- 著作権／商標：
元のミャクミャクの具体的キャラクター形状を模倣しないこと。抽象的・象徴的な要素（赤青の色使い、多眼・うねり・増殖）に限定する。
- パフォーマンス：
高解像度 canvas をそのままテクスチャにすると GPU 負荷が高くなる。テクスチャ解像度は適宜縮小して使用すること。
- 時間的制約：
短期の実装を想定しているため、複雑な物理シミュレーションや完全な粒子交互作用は簡易ルールで代替する。
- 将来機能：
音響（WebAudio でのドローン・ぬちょ音）は将来的に追加するため、Three.js 側に音同期フック（イベントフック）を残しておくこと。